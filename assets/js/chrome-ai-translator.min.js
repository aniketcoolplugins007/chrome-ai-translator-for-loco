class ChromeAiTranslator{static Object=options=>{const selfObject=new this(options);return selfObject.extraData()};constructor(options){this.btnSelector=options.btnSelector,this.stringSelector=options.stringSelector,this.progressBarSelector=options.progressBarSelector,this.onStartTranslationProcess=options.onStartTranslationProcess||(()=>{}),this.onComplete=options.onComplete||(()=>{}),this.onLanguageError=options.onLanguageError||(()=>{}),this.onBeforeTranslate=options.onBeforeTranslate||(()=>{}),this.onAfterTranslate=options.onAfterTranslate||(()=>{}),this.sourceLanguage=options.sourceLanguage||"en",this.targetLanguage=options.targetLanguage||"hi",this.targetLanguageLabel=options.targetLanguageLabel||"Hindi"}extraData=async()=>{const languageSupported=await this.langStatus();if("language-not-supported"===languageSupported){await new Promise(resolve=>setTimeout(resolve,500));const message=jQuery(`<br><span style="color: #ff4646; margin-top: .5rem; display: inline-block;">Unfortunately, the <strong>${this.targetLanguageLabel} (${this.targetLanguage})</strong> language is currently not supported by the Local Translator AI modal. Please check and read the docs which languages are currently supported by <a href="https://developer.chrome.com/docs/ai/translator-api#bypass_language_restrictions_for_local_testing" target="_blank">clicking here</a>.</span>`);return jQuery("#chrome-ai-translator_settings_btn"),this.onLanguageError(message),{}}if("api-disabled"===languageSupported){await new Promise(resolve=>setTimeout(resolve,500));const message=jQuery('<br><span style="color: #ff4646; margin-top: .5rem; display: inline-block;">The Translator AI modal is currently not supported or disabled in your browser. Please enable it. For detailed instructions on how to enable the Translator AI modal in your Chrome browser, <a href="https://developer.chrome.com/docs/ai/translator-api#bypass_language_restrictions_for_local_testing" target="_blank">click here</a>.</span>');return jQuery("#chrome-ai-translator_settings_btn"),this.onLanguageError(message),{}}if("after-download"===languageSupported){const message=jQuery(`<br><span style="color: #ff4646; margin-top: .5rem; display: inline-block;">Please install the <strong>${this.targetLanguageLabel} (${this.targetLanguage})</strong> language pack to proceed. For detailed instructions, please refer to the <a href="https://developer.chrome.com/docs/ai/translator-api#bypass_language_restrictions_for_local_testing" target="_blank">documentation here</a>.</span>`);return jQuery("#chrome-ai-translator_settings_btn"),this.onLanguageError(message),{}}if("readily"!==languageSupported){const message=jQuery(`<br><span style="color: #ff4646; margin-top: .5rem; display: inline-block;">Please confirm that the <strong>${this.targetLanguageLabel}(${this.targetLanguage})</strong> language pack is installed in your browser and included in your browser's preferred language settings. <a href="https://developer.chrome.com/docs/ai/translator-api#bypass_language_restrictions_for_local_testing" target="_blank">Instructions here</a></span>`);return this.onLanguageError(message),{}}return{continueTranslation:this.continueTranslation,stopTranslation:this.stopTranslation,startTranslation:this.startTranslation,reInit:this.reInit,init:this.init}};init=async()=>{this.translationStart=!1,this.completedTranslateIndex=0,this.completedCharacterCount=0,this.translateBtnEvents(),this.addProgressBar()};langStatus=async()=>{const supportedLanguages=["es","js","ar","bn","de","fr","hi","it","ko","nl","pl","pt","ru","th","tr","vi","zh","zh-hant","bg","cs","da","el","fi","hr","hu","id","iw","lt","no","ro","sk","sl","sv","uk","en-zh"].map(lang=>lang.toLowerCase());if(!("translation"in self&&"createTranslator"in self.translation))return"api-disabled";if(!supportedLanguages.includes(this.targetLanguage.toLowerCase()))return"language-not-supported";const defaultLangCode=this.targetLanguage||null;return this.defaultLang=this.mapLanguageCode(defaultLangCode),await translation.canTranslate({sourceLanguage:this.sourceLanguage,targetLanguage:this.defaultLang})};translateBtnEvents=e=>{this.translateStatus=!0,this.translateBtn=jQuery(this.btnSelector),this.translateBtn.off("click"),this.translateBtn.prop("disabled",!1),this.translationStart?this.translateStringEle.length>this.completedTranslateIndex+1?this.translateBtn.on("click",()=>{this.onStartTranslationProcess(),this.stringTranslation(this.completedTranslateIndex+1)}):(this.onComplete(),this.translateBtn.prop("disabled",!0)):this.translateBtn.on("click",this.startTranslationProcess)};mapLanguageCode=code=>{const languageMap={bel:"be",he:"iw",snd:"sd",jv:"jw",nb:"no",nn:"no"};return languageMap[code]||code};startTranslationProcess=async()=>{this.onStartTranslationProcess();const langCode=this.defaultLang;this.translationStart=!0,this.translateStringEle=jQuery(this.stringSelector),this.totalStringCount=Array.from(this.translateStringEle).map(ele=>ele.innerText.length).reduce((a,b)=>a+b,0),this.translator=await self.translation.createTranslator({sourceLanguage:"en",targetLanguage:langCode}),this.translateStringEle.length>0&&await this.stringTranslation(this.completedTranslateIndex)};stringTranslation=async index=>{if(!this.translateStatus)return;const ele=this.translateStringEle[index];this.onBeforeTranslate(ele);const originalString=ele.innerText,translatedString=await this.translator.translate(originalString);translatedString&&""!==translatedString&&(this.completedCharacterCount+=originalString.length,ele.innerText=translatedString),this.completedTranslateIndex=index,this.updateProgressBar(),this.onAfterTranslate(ele),this.translateStringEle.length>index+1&&await this.stringTranslation(this.completedTranslateIndex+1),index===this.translateStringEle.length-1&&(this.translateBtn.prop("disabled",!0),this.onComplete())};addProgressBar=()=>{if(!document.querySelector("#chrome-ai-translator-modal .chrome-ai-translator_progress_bar")){const progressBar=jQuery('<div class="chrome-ai-translator_progress_bar" style="background-color: #f3f3f3;border-radius: 10px;overflow: hidden;margin: 1.5rem auto; width: 50%;"><div class="chrome-ai-translator_progress" style="overflow: hidden;transition: width .5s ease-in-out; border-radius: 10px;text-align: center;width: 0%;height: 20px;box-sizing: border-box;background-color: #4caf50; color: #fff; font-weight: 600;"></div></div>');jQuery(this.progressBarSelector).append(progressBar)}};updateProgressBar=()=>{const progress=this.completedCharacterCount/this.totalStringCount*1e3/10;let decimalValue=progress.toString().split(".")[1]||"";decimalValue=decimalValue.length>0&&"0"!==decimalValue[0]?decimalValue[0]:"";const formattedProgress=parseInt(progress)+`${""!==decimalValue?"."+decimalValue:""}`;jQuery(".chrome-ai-translator_progress").css({width:`${formattedProgress}%`}).text(`${formattedProgress}%`)};stopTranslation=()=>{this.translateStatus=!1};reInit=()=>{this.translateBtnEvents()};startTranslation=()=>{this.translateStatus=!0,this.startTranslationProcess(this.completedTranslateIndex+1)}}(jQuery=>{jQuery(document).ready(async()=>{let transalationInitialize=!1;const TranslatorObject=await ChromeAiTranslator.Object({mainWrapperSelector:".chrome-ai-translator",btnSelector:".chrome-ai-translator #chrome_ai_translator_element #chrome_ai_translator_btn",stringSelector:".chrome-ai-translator-body table tbody tr td.target.translate",progressBarSelector:".latlt_progress_container",sourceLanguage:"en",targetLanguage:locoConf.conf.locale.lang,targetLanguageLabel:locoConf.conf.locale.label,onStartTranslationProcess:startTransaltion,onComplete:completeTranslation,onLanguageError:languageError,onBeforeTranslate:beforeTranslate});jQuery(document).on("click","#chrome-ai-translator_settings_btn",(function(){transalationInitialize||"function"!=typeof TranslatorObject.init?"function"==typeof TranslatorObject.reInit&&TranslatorObject.reInit():(transalationInitialize=!0,TranslatorObject.init())})),jQuery(window).on("click",event=>{jQuery("#chrome-ai-translator-modal").length>0&&!event.target.closest(".modal-content")&&!event.target.closest("#latlt-dialog")&&"none"!==jQuery("#chrome-ai-translator-modal").css("display")&&TranslatorObject.stopTranslation()}),jQuery(document).on("click",".chrome-ai-translator-header .close",()=>{TranslatorObject.stopTranslation()})});const startTransaltion=()=>{const stringContainer=jQuery("#chrome-ai-translator-modal .modal-content .latlt_string_container");stringContainer[0].scrollHeight>100&&jQuery("#chrome-ai-translator-modal .latlt_translate_progress").fadeIn("slow")},beforeTranslate=ele=>{const stringContainer=jQuery("#chrome-ai-translator-modal .modal-content .latlt_string_container"),scrollStringContainer=position=>{stringContainer.scrollTop(position)},stringContainerPosition=stringContainer[0].getBoundingClientRect(),eleTopPosition=ele.closest("tr").offsetTop,containerHeight=stringContainer.height();eleTopPosition>containerHeight+stringContainerPosition.y&&scrollStringContainer(eleTopPosition-containerHeight+ele.offsetHeight)},completeTranslation=()=>{setTimeout(()=>{jQuery("#chrome-ai-translator-modal .latlt_save_strings").prop("disabled",!1),jQuery("#chrome-ai-translator-modal .latlt_translate_progress").fadeOut("slow"),jQuery("#chrome-ai-translator-modal .latlt_stats").fadeIn("slow")},600)},languageError=message=>{jQuery("#chrome-ai-translator_settings_btn").after(message),jQuery("#chrome-ai-translator_settings_btn").attr("disabled",!0)}})(jQuery);