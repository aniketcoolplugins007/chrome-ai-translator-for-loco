((window,$)=>{const{locoConf:locoConf}=window,{ajax_url:ajaxUrl,nonce:nonce,LATLT_URL:LATLT_URL,extra_class:rtlClass}=window.extradata,initialize=async()=>{const langSupported=await checkChromeAILangStatus();"readily"===langSupported&&onLoad(),setupEventListeners()},checkChromeAILangStatus=async()=>{if(locoConf&&locoConf.conf){const{locale:locale}=locoConf.conf,canTranslate=await translation.canTranslate({sourceLanguage:"en",targetLanguage:locale.lang});return canTranslate}return!1},onLoad=()=>{if(locoConf&&locoConf.conf){const{conf:conf}=locoConf,allStrings=locoConf.conf.podata;allStrings.shift();const{locale:locale,project:project}=conf,projectId=generateProjectId(project,locale);checkChromeAILangStatus(),createStringsModal(projectId,"chrome-ai-translator"),addStringsInModal(allStrings),stringModalEvents()}},setupEventListeners=()=>{0===$("#loco-editor nav").find("#cool-auto-translate-btn").length&&addAutoTranslationBtn(),settingsModel(),$("#cool-auto-translate-btn").on("click",openSettingsModel),$("button.icon-robot[data-loco='auto']").on("click",onAutoTranslateClick),$(".latlt_save_strings").on("click",onSaveClick)},addStringsInModal=allStrings=>{const plainStrArr=filterRawObject(allStrings,"plain");plainStrArr.length>0?printStringsInPopup(plainStrArr):($("#ytWidget").hide(),$(".notice-container").addClass("notice inline notice-warning").html("There is no plain string available for translations."),$(".latlt_string_container, .choose-lang, .translator-widget, .notice-info, .is-dismissible").hide())},generateProjectId=(project,locale)=>{const{domain:domain}=project||{},{lang:lang,region:region}=locale;return project?`${domain}-${lang}-${region}`:`temp-${lang}-${region}`},onSaveClick=function(){const translatedObj=[],rpl={'"% s"':'"%s"','"% d"':'"%d"','"% S"':'"%s"','"% D"':'"%d"',"% s":" %s ","% S":" %s ","% d":" %d ","% D":" %d ","٪ s":" %s ","٪ S":" %s ","٪ d":" %d ","٪ D":" %d ","٪ س":" %s ","%S":" %s ","%D":" %d ","% %":"%%"},regex=/(\%\s*\d+\s*\$?\s*[a-z0-9])/gi;$(".latlt_strings_table tbody tr").each((function(){const source=$(this).find("td.source").text(),target=$(this).find("td.target").text(),improvedTarget=strtr(target,rpl).replace(regex,match=>match.replace(/\s/g,"").toLowerCase()),improvedSource=strtr(source,rpl).replace(regex,match=>match.replace(/\s/g,"").toLowerCase());translatedObj.push({source:improvedSource,target:improvedTarget})}));const projectId=$(this).parents(".latlt_custom_model").find("#project_id").val();saveTranslatedStrings(translatedObj,projectId),$(".latlt_custom_model").fadeOut("slow"),$("html").addClass("merge-translations"),updateLocoModel()},onAutoTranslateClick=e=>{if(e.originalEvent){const checkModal=setInterval(()=>{const locoModal=$(".loco-modal"),locoBatch=locoModal.find("#loco-apis-batch"),locoTitle=locoModal.find(".ui-dialog-titlebar .ui-dialog-title");locoBatch.length&&!locoModal.is(":hidden")&&(locoModal.removeClass("addtranslations"),locoBatch.find("select#auto-api").show(),locoBatch.find("a.icon-help, a.icon-group").show(),locoBatch.find("#loco-job-progress").show(),locoTitle.html("Auto-translate this file"),locoBatch.find("button.button-primary span").html("Translate"),1===locoBatch.find("select#auto-api option").length&&(locoBatch.find(".noapiadded").remove(),locoBatch.removeClass("loco-alert").find("form").hide().addClass("loco-alert"),locoTitle.html("No translation APIs configured"),locoBatch.append("\n                            <div class='noapiadded'>\n                                <p>Add automatic translation services in the plugin settings.<br>or<br>Use <strong>Auto Translate</strong> addon button.</p>\n                                <nav>\n                                    <a href='http://locotranslate.local/wp-admin/admin.php?page=loco-config&amp;action=apis' class='button button-link has-icon icon-cog'>Settings</a>\n                                    <a href='https://localise.biz/wordpress/plugin/manual/providers' class='button button-link has-icon icon-help' target='_blank'>Help</a>\n                                    <a href='https://localise.biz/wordpress/translation?l=de-DE' class='button button-link has-icon icon-group' target='_blank'>Need a human?</a>\n                                </nav>\n                            </div>")),clearInterval(checkModal))},100)}},updateLocoModel=()=>{const checkModal=setInterval(()=>{const locoModel=$(".loco-modal"),locoModelApisBatch=$(".loco-modal #loco-apis-batch");if(locoModel.length&&locoModel.attr("style").indexOf("none")<=-1&&locoModel.find("#loco-job-progress").length){$("html").removeClass("merge-translations"),locoModelApisBatch.find("a.icon-help, a.icon-group, #loco-job-progress").hide(),locoModelApisBatch.find("select#auto-api").hide();const currentState=$("select#auto-api option[value='loco_auto']").prop("selected","selected");locoModelApisBatch.find("select#auto-api").val(currentState.val()),locoModel.find(".ui-dialog-titlebar .ui-dialog-title").html("Step 3 - Add Translations into Editor and Save"),locoModelApisBatch.find("button.button-primary span").html("Start Adding Process").on("click",(function(){$(this).find("span").html("Adding...")})),locoModel.addClass("addtranslations"),$(".noapiadded").remove(),locoModelApisBatch.find("form").show().removeClass("loco-alert"),clearInterval(checkModal)}},200)},filterRawObject=(rawArray,filterType)=>rawArray.filter(item=>!(!item.source||item.target)&&(!ValidURL(item.source)&&!isHTML(item.source)&&!isSpecialChars(item.source)&&!isEmoji(item.source)&&!item.source.includes("#")||isPlacehodersChars(item.source))),ValidURL=str=>{const pattern=/(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/;return pattern.test(str)},isHTML=str=>{const rgex=/<(?=.*? .*?\/ ?>|br|hr|input|!--|wbr)[a-z]+.*?>|<([a-z]+).*?<\/\1>/i;return rgex.test(str)},isSpecialChars=str=>{const rgex=/[@^{}|<>]/g;return rgex.test(str)},isEmoji=str=>{const ranges=["(?:[✀-➿]|(?:\ud83c[\udde6-\uddff]){2}|[\ud800-\udbff][\udc00-\udfff]|[#-9]️?⃣|㊙|㊗|〽|〰|Ⓜ|\ud83c[\udd70-\udd71]|\ud83c[\udd7e-\udd7f]|🆎|\ud83c[\udd91-\udd9a]|\ud83c[\udde6-\uddff]|[\ud83c[\ude01-\ude02]|🈚|🈯|[\ud83c[\ude32-\ude3a]|[\ud83c[\ude50-\ude51]|‼|⁉|[▪-▫]|▶|◀|[◻-◾]|©|®|™|ℹ|🀄|[☀-⛿]|⬅|⬆|⬇|⬛|⬜|⭐|⭕|⌚|⌛|⌨|⏏|[⏩-⏳]|[⏸-⏺]|🃏|⤴|⤵|[←-⇿])"];return str.match(ranges.join("|"))},isPlacehodersChars=str=>{const rgex=/%s|%d/g;return rgex.test(str)},strtr=(...args)=>!!args[0]&&{2:function(){for(var i in args[1])args[0]=strtr(args[0],i,args[1][i]);return args[0]},3:function(){return args[0].replace(RegExp(args[1],"g"),args[2])},0:function(){}}[args.length](),saveTranslatedStrings=(translatedStrings,projectId)=>{if(translatedStrings&&translatedStrings.length>0){const batchSize=2500;for(let i=0;i<translatedStrings.length;i+=batchSize){const batch=translatedStrings.slice(i,i+batchSize),part=`-part-${Math.ceil(i/batchSize)}`;sendBatchRequest(batch,projectId,part)}}},sendBatchRequest=(stringData,projectId,part)=>{const data={action:"save_all_translations",data:JSON.stringify(stringData),part:part,"project-id":projectId,wpnonce:nonce};jQuery.post(ajaxUrl,data,()=>{$("#loco-editor nav").find("button").each((function(){const id=this.getAttribute("data-loco");"auto"!==id||$(this).hasClass("model-opened")||$(this).addClass("model-opened").trigger("click")}))})},addAutoTranslationBtn=()=>{const existingBtn=$("#loco-editor nav").find("#cool-auto-translate-btn");existingBtn.length>0&&existingBtn.remove();const locoActions=$("#loco-editor nav").find("#loco-actions"),autoTranslateBtn=$('<fieldset><button id="cool-auto-translate-btn" class="button has-icon icon-translate">Auto Translate</button></fieldset>');locoActions.append(autoTranslateBtn)},openSettingsModel=()=>{$("#latlt-dialog").dialog({dialogClass:rtlClass,resizable:!1,height:"auto",width:400,modal:!0,buttons:{Cancel:function(){$(this).dialog("close")}}})},stringModalEvents=()=>{$(window).on("click",event=>{event.target.closest(".modal-content")||event.target.closest("#latlt-dialog")||$(".latlt_custom_model").hide()}),$(".latlt_custom_model").find(".close").on("click",()=>{$(".latlt_custom_model").fadeOut("slow")})},encodeHtmlEntity=str=>{for(var buf=[],i=str.length-1;i>=0;i--)buf.unshift(["&#",str[i].charCodeAt(),";"].join(""));return buf.join("")},printStringsInPopup=jsonObj=>{let html="",totalTChars=0,index=1;if(jsonObj){for(const key in jsonObj)if(jsonObj.hasOwnProperty(key)){const sourceText=jsonObj[key].source.trim();sourceText&&(html+=`<tr id="${key}"><td>${index}</td><td class="source">${encodeHtmlEntity(sourceText)}</td>`,html+=`<td class="target translate">${encodeHtmlEntity(sourceText)}</td></tr>`,index++,totalTChars+=sourceText.length)}$(".latlt_stats").each((function(){$(this).find(".totalChars").html(totalTChars)}))}$(".latlt_strings_table > tbody.latlt_strings_body").html(html)},settingsModel=()=>{const chromeAiPreviewImg=`${LATLT_URL}assets/images/${window.extradata.chrome_ai_preview}`,modelHTML=`\n            <div id="latlt-dialog" title="Step 1 - Select Translation Provider" style="display:none;">\n                <div class="latlt-settings">\n                     <strong class="latlt-heading">Translate Using Chrome AI Translator</strong>\n                    <div class="inputGroup">\n                       <button id="latlt_chromeAI_btn" class="button button-primary">Chrome AI Translator</button>\n                        <br/><a href="https://translate.google.com/" target="_blank">Powered by <img src="${chromeAiPreviewImg}" alt="powered by Chrome AI Translator" width="25"> AI Translator</a>\n                    </div>\n                </div>\n            </div>\n        `;$("body").append(modelHTML)},createStringsModal=(projectId,widgetType)=>{const{wrapperCls:wrapperCls,headerCls:headerCls,bodyCls:bodyCls,footerCls:footerCls,wrapperId:wrapperId}=getWidgetClasses(widgetType),modelHTML=`\n            <div id="${wrapperId}" class="modal latlt_custom_model ${wrapperCls}${rtlClass?` ${rtlClass}`:""}">\n                <div class="modal-content">\n                    <input type="hidden" id="project_id" value="${projectId}"> \n                    ${modelHeaderHTML(widgetType,headerCls)}   \n                    ${modelBodyHTML(widgetType,bodyCls)}   \n                    ${modelFooterHTML(widgetType,footerCls)}   \n                </div>\n            </div>`;$("body").append(modelHTML)},getWidgetClasses=widgetType=>({wrapperCls:`${widgetType}-container`,headerCls:`${widgetType}-header`,bodyCls:`${widgetType}-body`,footerCls:`${widgetType}-footer`,wrapperId:`${widgetType}-model`}),modelBodyHTML=(widgetType,bodyCls)=>`\n        <div class="modal-body ${bodyCls}">\n            <div class="latlt_translate_progress">\n                Automatic translation is in progress....<br/>\n                It will take a few minutes, enjoy ☕ coffee in this time!<br/><br/>\n                Please do not leave this window or browser tab while the translation is in progress...\n            </div>\n            ${translatorWidget(widgetType)}\n            <div class="latlt_string_container">\n                <table class="scrolldown latlt_strings_table">\n                    <thead>\n                        <th>S.No</th>\n                        <th>Source Text</th>\n                        <th>Translation</th>\n                    </thead>\n                    <tbody class="latlt_strings_body"></tbody>\n                </table>\n            </div>\n            <div class="notice-container"></div>\n        </div>`,modelHeaderHTML=(widgetType,headerCls)=>`\n        <div class="modal-header ${headerCls}">\n            <span class="close">&times;</span>\n            <h2>Step 2 - Start Automatic Translation Process</h2>\n            <div class="latlt_actions">\n                <button class="latlt_save_strings button button-primary" disabled="true">Merge Translation</button>\n            </div>\n            <div style="display:none" class="latlt_stats hidden">\n                Wahooo! You have saved your valuable time via auto translating \n                <strong class="totalChars"></strong> characters using \n                <strong>\n                    <a href="https://wordpress.org/support/plugin/automatic-translator-addon-for-loco-translate/reviews/#new-post" target="_new">\n                        Loco Automatic Translate Addon\n                    </a>\n                </strong>\n            </div>\n        </div>\n        <div class="notice inline notice-info is-dismissible">\n            Plugin will not translate any strings with HTML or special characters because Chrome AI Translator currently does not support HTML and special characters translations.\n                        You can edit translated strings inside Loco Translate Editor after merging the translations. Only special characters (%s, %d) fixed at the time of merging of the translations.\n        </div>\n        <div class="notice inline notice-info is-dismissible">\n            Machine translations are not 100% correct.\n            Please verify strings before using on the production website.\n        </div>`,modelFooterHTML=(widgetType,footerCls)=>`\n        <div class="modal-footer ${footerCls}">\n            <div class="latlt_actions">\n                <button class="latlt_save_strings button button-primary" disabled="true">Merge Translation</button>\n            </div>\n            <div style="display:none" class="latlt_stats">\n                Wahooo! You have saved your valuable time via auto translating \n                <strong class="totalChars"></strong> characters using \n                <strong>\n                    <a href="https://wordpress.org/support/plugin/automatic-translator-addon-for-loco-translate/reviews/#new-post" target="_new">\n                        Loco Automatic Translate Addon\n                    </a>\n                </strong>\n            </div>\n        </div>`,translatorWidget=widgetType=>"chrome-ai-translator"===widgetType?`\n                <div class="translator-widget ${widgetType}">\n                    <h3 class="choose-lang">Translate Using Chrome AI Translator <span class="dashicons-before dashicons-translation"></span></h3>\n                    <div id="chrome_ai_translator_element"><button id="chrome_ai_translator_btn">Translate to ${locoConf.conf.locale.label}</button></div>\n                </div>`:"";$(document).ready(initialize)})(window,jQuery);